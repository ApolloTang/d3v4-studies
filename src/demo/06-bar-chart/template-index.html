<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>bar chart</title>
  <style type="text/less">
    * { margin: 0; padding: 0; box-sizing: border-box; }
  </style>
</head>

<body>
  <div class="chart">
    Chart has not being loaded
  </div>
  <script src="http://localhost:9091/less/dist/less.js"></script>
  <script src="http://localhost:9091/lodash/lodash.js"></script>
  <script src="http://localhost:9091/chance/chance.js"></script>
  <script src="http://localhost:9091/d3/d3.js"></script>
  <script src="http://localhost:9091/d3/d3-selection-multi.v1.js"></script>
  <script>

  // Configuration
  const svgDim = { w:500, h:200 };
  const svgMarg = { t:20, r:20, b:20, l:20 }
  const stageDim = {
    w: svgDim.w - svgMarg.l - svgMarg.r,
    h: svgDim.h - svgMarg.t - svgMarg.b
  };

  // Chart container
  const container = d3.select('.chart')
  container
    .text('')
    .styles({
      width: svgDim.w+'px', height: svgDim.h+'px',
      background: 'hsl(0, 30%, 90%)'
    });

  // Svg container
  const svg =  container.append('svg');
  svg
    .styles({
      width: svgDim.w,
      height: svgDim.h,
    });

  // Stage
  const stage = svg.append('g');
    stage.attr('transform', `translate(${svgMarg.l}, ${svgMarg.t})`)

  // Stage background
  const stageBg = stage.append('rect');
  stageBg
    .styles({
      width: stageDim.w, height: stageDim.h,
      fill: 'hsl(120, 30%, 90%)'
    });

  // plotting area
  const area = stage.append('g');

  //--------------------------------------

  const data = [
    {name:'a', value:100},
    {name:'b', value:200},
    {name:'c', value:300},
    {name:'d', value:1900},
    {name:'e', value:100},
    {name:'f', value:200},
    {name:'g', value:300},
    {name:'h', value:1900},
  ];

  const scaleX = d3.scaleBand()
    .domain(_(data).map('name').value())
    .range([0, stageDim.w])
  // _(data).map('name').map(scaleX).value()

  scaleX.padding(.2)

  const scaleY = d3.scaleLinear()
    .domain([0, d3.max( _(data).map('value').value())])
    .range([0, stageDim.h])
  // _(data).map('value').map(scaleY).value()

  const bars = d3.select(area.node())
    .selectAll('g')
    .data(data)
    .enter()
    .append('g')
    .attr('transform', d=>{
      const y = stageDim.h - scaleY(d.value);
      const x = scaleX(d.name);
      return `translate(${x},${y})`
    })

  bars
    .append('rect')
    .attr('width', scaleX.bandwidth())
    .attr('height', d=>scaleY(d.value))
    .attr('fill', 'hsl(240, 70%, 80%)');

  bars
    .on('mouseover', function(d){
      d3.select(this)
        .append('text')
        .text(d=>`${d.name}:${d.value}`)
          .styles({
            fill: 'black',
            'text-anchor': 'middle',
          })
          .attr('x', `${scaleX.bandwidth()/2}`)
    });

  bars
    .on('mouseout', function(d){
      d3.select(this)
        .select('text')
          .remove();
    });

  </script>
</body>

</html>
